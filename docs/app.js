webpackJsonp([0],[,,,,,function(e,t,n){"use strict";function i(e,t){t.when("/game",{template:"<game></game>"}).when("/leaders",{template:"<leaders></leaders>"}).when("/settings",{template:"<settings></settings>"}).otherwise("/game"),e.hashPrefix("")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i,i.$inject=["$locationProvider","$routeProvider"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r={template:'\n\t\t<div class="game">\n\t\t\n      <div class="row">\n        <div class="small-12 columns">\n          <h1>Game</h1>\n          <hr />\n          <div class="game-board" hm-panend="$ctrl.onPan($event)">\n            <div class="tile" ng-repeat="tile in $ctrl.tiles track by $index"\n              ng-style="{ top: tile.position_y * $ctrl.tileSize + \'px\', left: tile.position_x * $ctrl.tileSize + \'px\' }"\n              ng-class="{ empty: tile.canvas === null }"\n              ng-click="$ctrl.moveByClick(tile)">\n              \x3c!--hm-tap="$ctrl.moveByTap(tile)"--\x3e\n              <img ng-src="{{ $ctrl.scramble.getImageFromTile(tile)}}"\n                   ng-style="{ width: $ctrl.tileSize, height: $ctrl.tileSize }">\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <br />\n    \n      <div class="row">\n        <div class="small-12 columns text-center">\n          <button class="button radius" ng-click="$ctrl.startGame()" ng-if="!$ctrl.stat.isGameRunning()">\n            <i class="fa fa-play" aria-hidden="true"></i>\n            Start Game\n          </button>\n          <button class="button radius" ng-click="$ctrl.endGame()" ng-if="$ctrl.stat.isGameRunning()">\n            <i class="fa fa-stop" aria-hidden="true"></i>\n            Stop Game\n          </button>\n          \n          <h4 ng-if="$ctrl.stat.isGameRunning()">\n            <span>dimension: {{ $ctrl.$storage.dimension }},</span>\n            <span>time: {{ $ctrl.stat.getGameTime() }} sec,</span>\n            <span>moves count: {{ $ctrl.stat.getMovesCount() }}</span>\n          </h4>\n        </div>\n      </div>\n      \n    </div>\n\t',controller:function(){function e(t,n,a,r,s,o,l,u,c){i(this,e),this.$scope=t,this.$timeout=n,this.$element=a,this.$document=r,this.modal=s,this.scramble=l,this.$shuffle=u,this.stat=c,this.$storage=o.getStorage(),this.tileSize=Math.floor(o.getBoardSize()/this.$storage.dimension)}return a(e,null,[{key:"$inject",get:function(){return["$scope","$timeout","$element","$document","modal","storage","scramble","shuffle","stat"]}}]),a(e,[{key:"$onInit",value:function(){var e=this;this.scramble.getTiles().then(function(t){e.tiles=t.map(function(e){return e.position_x=e.x,e.position_y=e.y,e})}),this.$document.on("keydown",this.keyDownHandler(this))}},{key:"$onDestroy",value:function(){this.$document.off("keydown",this.keyDownHandler(this)),this.stat.stopGame()}},{key:"startGame",value:function(){this.swapTiles(this.tiles[this.tiles.length-1],this.tiles[this.tiles.length-2]),this.stat.startGame()}},{key:"endGame",value:function(){for(var e=0;e<this.tiles.length;e++)this.tiles[e].position_x=this.tiles[e].x,this.tiles[e].position_y=this.tiles[e].y;this.stat.stopGame()}},{key:"swapTiles",value:function(e,t){var n=this,i=[t.position_x,e.position_x];e.position_x=i[0],t.position_x=i[1];var a=[t.position_y,e.position_y];if(e.position_y=a[0],t.position_y=a[1],this.stat.isGameRunning()&&(this.stat.doMove(),this.stat.isWin(this.tiles))){this.stat.stopGame();var r=this.$storage.dimension,s=this.stat.getGameTime(),o=this.stat.getMovesCount();this.modal.openWin(r,s,o).then(function(e){e&&n.stat.saveResult(e,r,s,o)})}}},{key:"moveByClick",value:function(e){if(this.stat.isGameRunning()){var t=this.tiles.find(function(e){return null===e.canvas});if(t){var n=t.position_x-e.position_x,i=t.position_y-e.position_y,a=0===n&&1===Math.abs(i),r=0===i&&1===Math.abs(n);(a||r)&&this.swapTiles(t,e)}}}},{key:"moveByKeyPress",value:function(e){if(this.stat.isGameRunning()){var t=this.tiles.find(function(e){return null===e.canvas}),n={x:t.position_x,y:t.position_y};if(t)switch(e){case"left":n.x++;break;case"top":n.y++;break;case"right":n.x--;break;case"bottom":n.y--;break;default:n=null}if(n){var i=this.tiles.find(function(e){return e.position_x===n.x&&e.position_y===n.y});i&&this.swapTiles(t,i)}}}},{key:"keyDownHandler",value:function(e){var t=function(e){switch(e){case 37:case 65:return"left";case 38:case 87:return"top";case 39:case 68:return"right";case 40:case 83:return"bottom"}return null};return function(n){var i=t(n.keyCode);i&&e.$scope.$apply(function(){e.moveByKeyPress(i)})}}},{key:"onPan",value:function(e){var t=function(e){switch(e){case 2:return"left";case 8:return"top";case 4:return"right";case 16:return"bottom"}return null}(e.direction);t&&(console.log(e),this.moveByKeyPress(t))}}]),e}()};t.default=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r={template:'\n\t\t<div class="row">\n      <div class="small-12 columns">\n        <a href="/#/game" class="button radius" ng-class="{ \'secondary\': !$ctrl.isCurrent(\'/game\') }">\n            <i class="fa fa-gamepad" aria-hidden="true"></i>\n            \x3c!----\x3e\n            Game\n        </a>\n        <a href="/#/leaders" class="button radius" ng-class="{ \'secondary\': !$ctrl.isCurrent(\'/leaders\') }">\n            \x3c!--<i class="fa fa-star" aria-hidden="true"></i>--\x3e\n            <i class="fa fa-trophy" aria-hidden="true"></i>\n            Leaders\n        </a>\n        <a href="/#/settings" class="button radius info right">\n          <i class="fa fa-cog" aria-hidden="true"></i>\n          Settings\n        </a>\n      </div>\n\t\t</div>\n\t',controller:function(){function e(t){i(this,e),this.$location=t}return a(e,null,[{key:"$inject",get:function(){return["$location"]}}]),a(e,[{key:"isCurrent",value:function(e){return this.$location.path()===e}}]),e}()};t.default=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r={template:'\n\t\t<div class="row">\n      <div class="small-12 columns">\n        <h1>Leaders</h1>\n        <hr />\n        <ul>\n            <li ng-repeat="score in $ctrl.$storage.score track by $index">\n                {{ score | json }}\n            </li>\n        </ul>\n      </div>\n\t\t</div>\n\t',controller:function(){function e(t){i(this,e),this.$storage=t.getStorage()}return a(e,null,[{key:"$inject",get:function(){return["storage"]}}]),e}()};t.default=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r={template:'\n\t\t<div class="row settings">\n      <div class="small-12 columns">\n        <h1>Settings</h1>\n        <hr />\n        <div class="dimension-preview" ng-if="!$ctrl.isLoading">\n            <canvas></canvas>\n        </div>\n        <div class="dimension-preview-loader" ng-if="$ctrl.isLoading">\n            <i class="fa fa-refresh fa-spin fa-3x fa-fw"></i>\n        </div>\n        <h2>\n          <label>\n            Board dimensions\n            <input type="range" min="2" max="10" ng-model="$ctrl.dimension" ng-change="$ctrl.updateDimensionPreview()">\n            <span>{{ $ctrl.dimension }}</span>\n          </label>\n        </h2>\n        <h2 ng-click="$ctrl.highlightRightPlace = !$ctrl.highlightRightPlace">\n          <label>\n            <i class="fa fa-check-square-o" aria-hidden="true" ng-show="$ctrl.highlightRightPlace"></i>\n            <i class="fa fa-square-o" aria-hidden="true" ng-show="!$ctrl.highlightRightPlace"></i>\n            Highlight tile in right place (in this example used random color)\n          </label>\n        </h2>\n        <h2 ng-click="$ctrl.showNumber = !$ctrl.showNumber">\n          <label>\n            <i class="fa fa-check-square-o" aria-hidden="true" ng-show="$ctrl.showNumber"></i>\n            <i class="fa fa-square-o" aria-hidden="true" ng-show="!$ctrl.showNumber"></i>\n            Show Numbers\n          </label>\n        </h2>\n       </div>\n\t\t</div>\n\t',controller:function(){function e(t,n,a,r,s){i(this,e),this.$timeout=t,this.$element=n,this.$scope=a,this.scramble=s,this.$storage=r.getStorage(),this.boardSize=r.getBoardSize()}return a(e,null,[{key:"$inject",get:function(){return["$timeout","$element","$scope","storage","scramble"]}}]),a(e,[{key:"$onInit",value:function(){this.dimension=this.$storage.dimension,this._showNumber=this.$storage.showNumber,this._highlightRightPlace=this.$storage.highlightRightPlace,this.updateDimensionPreview()}},{key:"updateDimensionPreview",value:function(){var e=this;this.isLoading=!0,this.$storage.dimension=this.dimension,this.scramble.generate(this.dimension,this._showNumber,this._highlightRightPlace).then(function(t){return e.isLoading=!1,e.$timeout(function(){return t},0)}).then(function(t){var n=e.$element.find("canvas")[0],i=n.getContext("2d");n.width=e.boardSize,n.height=e.boardSize,i.clearRect(0,0,n.width,n.height),i.putImageData(t.getImageData(0,0,n.width,n.height),0,0)})}},{key:"highlightRightPlace",get:function(){return this._highlightRightPlace},set:function(e){this._highlightRightPlace=e,this.$storage.highlightRightPlace=e,this.updateDimensionPreview()}},{key:"showNumber",get:function(){return this._showNumber},set:function(e){this._showNumber=e,this.$storage.showNumber=e,this.updateDimensionPreview()}}]),e}()};t.default=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){i(this,e),this.score=t}return a(e,null,[{key:"$inject",get:function(){return["score"]}}]),e}(),s=function(){function e(t){i(this,e),this.$modal=t}return a(e,null,[{key:"$inject",get:function(){return["$modal"]}}]),a(e,[{key:"openWin",value:function(e,t,n){return this.$modal.open({template:'\n        <div>\n          <h2>You win!</h2>\n          <h4>Your result: </h4>\n          <p>\n            <span>dimension: <strong>{{ modalCtrl.score.dimension}}</strong></span>\n            <span>time: <strong>{{ modalCtrl.score.time}}</strong> sec</span>\n            <span>moves: <strong>{{ modalCtrl.score.movesCount}}</strong></span>\n          </p>\n          <h3>Please, enter your name</h3>\n          <input type="text" ng-model="modalCtrl.name" style="font-size: 2em;" autofocus />\n          <button class="button" ng-click="$close(modalCtrl.name)">OK</button>\n          <a class="close-reveal-modal" ng-click="$dismiss()">&#215;</a>\n        </div>\n      ',backdrop:"static",keyboard:!1,windowClass:"tiny",controllerAs:"modalCtrl",controller:r,resolve:{score:function(){return{dimension:e,time:t,movesCount:n}}}}).result.then(function(e){return e},function(e){return e})}}]),e}();t.default=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(e){var t=e.defer(),n=new Image;return n.onload=function(){t.resolve(this)},n.src="/images/nature.jpg",t.promise},s=function(){function e(t,n){i(this,e),this.$q=t,this.$storage=n.getStorage(),this.imagePromiseCache=null,this.tiles=[],this.maxFontSize=72}return a(e,null,[{key:"$inject",get:function(){return["$q","storage"]}}]),a(e,[{key:"imagePromise",value:function(){return this.imagePromiseCache||(this.imagePromiseCache=r(this.$q)),this.imagePromiseCache}},{key:"getTiles",value:function(){var e=this;return this.tiles.length?this.$q.when(this.tiles):this.generate(this.$storage.dimension,this.$storage.showNumber,this.$storage.highlightRightPlace).then(function(){return e.tiles})}},{key:"drawImagePart",value:function(e,t,n,i,a,r,s){e.drawImage(t,n*a*r,i*a*r,a*r,a*r,n*a+s,i*a+s,a-2*s,a-2*s)}},{key:"drawHighlight",value:function(e,t,n,i,a){e.strokeRect(t*i+a,n*i+a,i-2*a,i-2*a)}},{key:"drawNumber",value:function(e,t,n,i,a){var r=e.strokeStyle;e.font=t+"px Arial",e.textAlign="center",e.lineWidth=1,e.strokeStyle="black",e.strokeText(n.toString(),i+1,a+1),e.lineWidth=1,e.strokeStyle=r,e.strokeText(n.toString(),i,a)}},{key:"getTileAsCanvas",value:function(e,t,n,i,a,r){var s=document.createElement("canvas"),o=s.getContext("2d");return s.width=i,s.height=i,o.clearRect(0,0,s.width,s.height),o.drawImage(e,t*i*a,n*i*a,i*a,i*a,r,r,i-2*r,i-2*r),s}},{key:"getImageFromTile",value:function(e){if(e.canvas){var t=e.canvas.width,n=e.canvas.height,i=document.createElement("canvas"),a=i.getContext("2d");if(i.width=t,i.height=n,a.clearRect(0,0,i.width,i.height),a.drawImage(e.canvas,0,0,t,n,0,0,t,n),this.$storage.highlightRightPlace){var r=e.x===e.position_x,s=e.y===e.position_y;a.strokeStyle=r&&s?"green":"red",a.strokeRect(3,3,t-6,n-6)}else a.strokeStyle="black";if(this.$storage.showNumber){var o=this.maxFontSize/this.$storage.dimension*2,l=t/2,u=n/2+o/2,c=e.y*this.$storage.dimension+e.x+1;this.drawNumber(a,o,c,l,u)}return i.toDataURL()}return null}},{key:"generate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.imagePromise().then(function(a){t.tiles=[];var r=Math.floor(480/e),s=a.width/480,o=document.createElement("canvas"),l=o.getContext("2d");o.width=480,o.height=480,l.clearRect(0,0,o.width,o.height);for(var u=0;u<e;u++)for(var c=0;c<e;c++)if(u!==e-1||c!==e-1){if(t.tiles.push({x:u,y:c,canvas:t.getTileAsCanvas(a,u,c,r,s,3)}),t.drawImagePart(l,a,u,c,r,s,3),i?(l.strokeStyle=Math.random()>.5?"red":"green",t.drawHighlight(l,u,c,r,3)):l.strokeStyle="black",n){var h=t.maxFontSize/e*2,f=u*r+r/2,g=c*r+r/2+h/2,d=c*e+u+1;t.drawNumber(l,h,d,f,g)}}else t.tiles.push({x:u,y:c,canvas:null});return l})}}]),e}();t.default=s},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){i(this,e)}return a(e,[{key:"array",value:function(e){return function(e){for(var t=e.length;t;t--){var n=Math.floor(Math.random()*t),i=[e[n],e[t-1]];e[t-1]=i[0],e[n]=i[1]}return e}(e)}}]),e}();t.default=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t,n){i(this,e),this.$interval=t,this.$storage=n.getStorage(),this.startingTime=null,this.movesCount=0,this.timerHandler=null}return a(e,null,[{key:"$inject",get:function(){return["$interval","storage"]}}]),a(e,[{key:"startGame",value:function(){var e=this;this.startingTime=+new Date,this.endingTime=+new Date,this.movesCount=0,this.timerHandler=this.$interval(function(){e.endingTime=+new Date},1e3)}},{key:"getMovesCount",value:function(){return this.movesCount}},{key:"getGameTime",value:function(){return Math.floor((this.endingTime-this.startingTime)/1e3)}},{key:"isGameRunning",value:function(){return!!this.timerHandler}},{key:"doMove",value:function(){this.movesCount++}},{key:"isWin",value:function(e){for(var t=e.length,n=0;n<t;n++){if(e[n].x!==e[n].position_x)return!1;if(e[n].y!==e[n].position_y)return!1}return!0}},{key:"stopGame",value:function(){this.$interval.cancel(this.timerHandler),this.timerHandler=void 0}},{key:"saveResult",value:function(e,t,n,i){var a=+new Date;this.$storage.score.push({username:e,dimension:t,gameTime:n,movesCount:i,time:a})}}]),e}();t.default=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){i(this,e),this.$storage=t.$default({dimension:4,showNumber:!0,highlightRightPlace:!0,score:[{username:"Georgy",dimension:4,gameTime:20,movesCount:10,time:1494096553227}]})}return a(e,null,[{key:"$inject",get:function(){return["$localStorage"]}}]),a(e,[{key:"getStorage",value:function(){return this.$storage}},{key:"getBoardSize",value:function(){return 480}}]),e}();t.default=r},function(e,t){},,,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var a=n(0),r=i(a),s=n(3),o=i(s),l=n(2),u=i(l);n(1),n(4);var c=n(5),h=i(c),f=n(11),g=i(f),d=n(14),m=i(d),v=n(12),p=i(v),y=n(13),b=i(y),$=n(10),w=i($),k=n(7),_=i(k),P=n(6),x=i(P),C=n(8),S=i(C),T=n(9),j=i(T);n(15),r.default.module("game",[o.default,u.default,"ngStorage","mm.foundation"]).config(h.default).service("scramble",g.default).service("storage",m.default).service("shuffle",p.default).service("stat",b.default).service("modal",w.default).component("header",_.default).component("game",x.default).component("leaders",S.default).component("settings",j.default),r.default.bootstrap(document,["game"])}],[20]);
//# sourceMappingURL=app.js.map